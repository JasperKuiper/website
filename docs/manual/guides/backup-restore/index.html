<!doctype html>
<html lang="en-GB" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-manual/guides/backup-restore">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Backup, Migrations and Restore | TrueCharts</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://truecharts.org/docs/manual/guides/backup-restore"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Backup, Migrations and Restore | TrueCharts"><meta data-rh="true" name="description" content="This guide has been written with the best efforts of the staff and tested as best possible. We are not responsible if it doesn&#x27;t work for every scenario or user situation."><meta data-rh="true" property="og:description" content="This guide has been written with the best efforts of the staff and tested as best possible. We are not responsible if it doesn&#x27;t work for every scenario or user situation."><link data-rh="true" rel="icon" href="/img/favicon/favicon.ico"><link data-rh="true" rel="canonical" href="https://truecharts.org/docs/manual/guides/backup-restore"><link data-rh="true" rel="alternate" href="https://truecharts.org/docs/manual/guides/backup-restore" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://truecharts.org/docs/manual/guides/backup-restore" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://M5JIEOBD9S-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="TrueCharts RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="TrueCharts Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="TrueCharts" href="/opensearch.xml">

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9270569596814796" crossorigin="anonymous"></script><link rel="stylesheet" href="/assets/css/styles.025026ad.css">
<link rel="preload" href="/assets/js/runtime~main.2f9b4fac.js" as="script">
<link rel="preload" href="/assets/js/main.4280ca0c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/1024.png" alt="TrueCharts logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/1024.png" alt="TrueCharts logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">TrueCharts</b></a><a class="navbar__item navbar__link" href="/blog">Blog</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/manual/intro">Docs</a><a class="navbar__item navbar__link" href="/docs/charts/description_list">Charts</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/manual/guides/backup-restore" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-GB">English</a></li></ul></div><a href="https://github.com/truecharts/apps" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/manual/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/manual/FAQ">F.A.Q. (Frequently Asked Questions)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/manual/systemrequirements">System Requirements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/manual/SUPPORT">Support Policy</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/manual/development/License-headers">Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/manual/guides/Important-MUST-READ">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/guides/Important-MUST-READ">IMPORTANT: Must Read!</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/guides/Adding-TrueCharts">Adding TrueCharts to SCALE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/guides/Installing-an-App">Installing Apps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/guides/Edit-an-App">Editing Apps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/guides/Upgrade-rollback-delete-an-App">Upgrading, Rollback and Delete</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/guides/add-storage">Adding additional storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/guides/linking-apps">Linking Apps Internally</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/guides/adding-letsencrypt">Adding Lets-Encrypt Certificates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/guides/add-ingress">Reverse Proxy using Ingress</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/guides/external-services">Setting up External-Services</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/guides/vpn-setup">VPN Addon Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/guides/docker-compose">Docker-Compose on SCALE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/manual/guides/backup-restore">Backup, Migrations and Restore</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/guides/pvc-access">Accessing PVC Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/guides/networking">App Network Options</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/guides/pci-passthrough">PCI(-E) Devices Passthrough</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/guides/truenas-web-gui-via-traefik">TrueNAS Web GUI via Traefik</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/manual/guides/validation">Input Validation</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/manual/options/">Configuration Options</a><button aria-label="Toggle the collapsible sidebar category &#x27;Configuration Options&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Guides</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Backup, Migrations and Restore</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Backup, Migrations and Restore</h1><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Best Effort Policy</div><div class="admonitionContent_S0QG"><p>This guide has been written with the best efforts of the staff and tested as best possible. We are not responsible if it doesn&#x27;t work for every scenario or user situation.
This guide has been thoroughly tested with TrueNAS SCALE 22.02.4.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="requirements">Requirements<a class="hash-link" href="#requirements" title="Direct link to heading">​</a></h2><p>This guide makes use of our command-line tool, called <code>TrueTool</code> and assumes you&#x27;ve already created backups using the BASH TrueTool.</p><p>Please refer to the GitHub page for <a href="https://github.com/truecharts/truetool" target="_blank" rel="noopener noreferrer">Truetool</a> to follow the commands and instructions below.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="zfs-replication">ZFS replication<a class="hash-link" href="#zfs-replication" title="Direct link to heading">​</a></h3><p>Our only officially supported system for &quot;offsite&quot; backups is ZFS replication. Offsite can be either another machine, a zfs formated usb drive or other pool on the same system without any issues when it comes to the guides.</p><p>However, whilst zfs replication CAN be done to an archive file, which can be saved in whatever way the user fancies, we do not provide official support for it. Using zfs replication in this manner exponentially increases the chance of complications. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="backup">Backup<a class="hash-link" href="#backup" title="Direct link to heading">​</a></h2><p>If you haven&#x27;t created a manual backup yet using <code>truetool</code> one must be created before any of the following steps below.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">bash</span><span class="token plain"> /</span><span class="token environment constant" style="color:#36acaa">PATH</span><span class="token plain">/TO/truetool_DIRECTORY/truetool.sh -b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It automatically deletes excessive backups, which defaults to a max. of 14 backups. To increase this, to 31 for example, use:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">bash</span><span class="token plain"> /</span><span class="token environment constant" style="color:#36acaa">PATH</span><span class="token plain">/TO/truetool_DIRECTORY/truetool.sh -b </span><span class="token number" style="color:#36acaa">31</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This can also easily be combined with other <code>truetool</code> options, such as update, sync, prune etc. like this:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">bash</span><span class="token plain"> /</span><span class="token environment constant" style="color:#36acaa">PATH</span><span class="token plain">/TO/truetool_DIRECTORY/truetool.sh -b </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> -sup</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>As mentioned above, all the commands and the various options for <code>truetool</code> are available on the <a href="https://github.com/truecharts/truetool" target="_blank" rel="noopener noreferrer">Truetool GitHub</a> page</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="exporting-backups">Exporting Backups<a class="hash-link" href="#exporting-backups" title="Direct link to heading">​</a></h3><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Replication</div><div class="admonitionContent_S0QG"><p>The instructions below are designed to showcase the specific replication paremeters required for fail-safe replication of the <code>ix-applications</code> dataset. It does not intend to cover everything related to replication on TrueNAS SCALE.</p><p>Please setup your ZFS replication in accordance with the TrueNAS Documentation, your off-site backup provider and/or the form of replication (local vs offsite) you want to do.</p></div></div><p>The above only creates only a backup of the kubernetes objects and a snapshot of the <code>PVC</code> and <code>ix_volume</code> storage.
These backups are saved under the same ix_applications dataset.</p><p>It does not protect these against, for example, deletion of datasets or save them on an external system.</p><p>We <strong>highly</strong> advise making both an internal backup (separate dataset on the same system) <em>and</em> an offsite backup.
One could create a normal recursive(!) replication of the <code>ix-volumes</code> dataset using the SCALE GUI, with the following few special tricks by editing the replication after creation:</p><p>To do so, setup the following replication task:</p><p><img loading="lazy" alt="rep2" src="/assets/images/Replication2-605b41570010b7895ed57977fc7a8df9.png" width="1235" height="1657" class="img_ev3q">
<img loading="lazy" alt="rep3" src="/assets/images/Replication3-bc79978e4f2cbee39ee74b5559394bcf.png" width="1218" height="1680" class="img_ev3q"></p><p>It&#x27;s also important to ensure you keep regular config backups of the SCALE system itself, preferably right after the Apps backup above).
However this is not part of this guide and we will assume you&#x27;ve done so yourself.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="checking-backups">Checking Backups<a class="hash-link" href="#checking-backups" title="Direct link to heading">​</a></h3><p>To make which backups are present, one can use <code>truetool</code> command and select the 3rd option to get a list of backups</p><p><img loading="lazy" alt="TrueTool-Main" src="/assets/images/TrueTool-Main-4003db7f3358b9abb466b2a20d3757c0.png" width="718" height="786" class="img_ev3q"></p><p>Which results in</p><p><img loading="lazy" alt="TrueTool-BackupList" src="/assets/images/TrueTool-Backup-List-cf91ddec58d9db7d4f2b190244eb5ef9.png" width="439" height="394" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="restore">Restore<a class="hash-link" href="#restore" title="Direct link to heading">​</a></h2><p>One of the most important parts of backups is to ensure they can be restored.
There are two scenario&#x27;s for a restore:</p><ol><li><p>Reverting a working system</p></li><li><p>Total System Restore</p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="reverting-a-running-system">Reverting a running system<a class="hash-link" href="#reverting-a-running-system" title="Direct link to heading">​</a></h3><p>Reverting a running system is rather trivial. But there are a few caveats:</p><ul><li>This will reinitialize the kubernetes node, which means all kubernetes objects that are not deployed using the Apps system will get reverted</li><li>You CANNOT revert a single Apps</li></ul><p>To revert an existing system, the process is as follows:</p><ol><li><p>List your current backups using <code>truetool</code></p></li><li><p>Select option 5 <code>Restore a Backup</code></p></li><li><p>Choose Backup and answer the prompt</p></li></ol><p><img loading="lazy" alt="TrueTool-RestoreList" src="/assets/images/TrueTool-Restore-List-81a1a241399fd8515837e01e78f81b11.png" width="742" height="489" class="img_ev3q"></p><p>Please keep in mind this can take a LONG time, so be sure to wait a few hours before touching the system again.
When done, a reboot might be adviceable</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="total-system-restore-and-migration-to-new-system">Total System restore and Migration to new system<a class="hash-link" href="#total-system-restore-and-migration-to-new-system" title="Direct link to heading">​</a></h3><blockquote><p>Sometimes you either need to wipe your system, Migrate to a new system or restore a system completely.
With the steps below, this is all very-much-possible.</p></blockquote><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Ensure a Clean system</div><div class="admonitionContent_S0QG"><ul><li>Ensure a clean system, without Apps or configuration except the bare minimum network configuration</li><li>Do not choose an apps pool yet, or do ANYTHING with apps until step 3</li><li>Please do not restore SCALE configuration from backup-file, before Apps pool replication is finished.</li><li>We&#x27;ve only tested this on non-encrypted <code>ix-applications</code> datasets, as encryption of <code>ix-applications</code> is officially not supported.</li></ul></div></div><ol><li><p>Using ZFS replication, move back the previously backed-up <code>ix-applications</code> dataset to the disk that will contain the future Apps Pool. This was covered in the <a href="#exporting-backups">Exporting Backups</a> section.</p></li><li><p><em>Optional/untested</em>: When the SCALE system itself is also wiped, ensure to restore it using a SCALE config export <strong>first</strong>.</p></li><li><p>Once the ZFS replication is complete, on the new or migrated system navigate to the <strong>Apps</strong> tab in the Truenas Scale GUI. When prompted to select a pool, select the pool containing the <code>ix-applications</code> dataset.</p></li><li><p>All you need to do now is restore the Truetool snapshot of your <code>ix-applications</code> dataset by following the <a href="#reverting-a-running-system">Reverting a running system</a> guide above.</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="video-guide">Video Guide<a class="hash-link" href="#video-guide" title="Direct link to heading">​</a></h2><p>TBD</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="developer-notes">Developer notes<a class="hash-link" href="#developer-notes" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pvc-mountpoints-on-replication">PVC mountpoints on replication<a class="hash-link" href="#pvc-mountpoints-on-replication" title="Direct link to heading">​</a></h3><p>In some/all cases PVC mountpoints are not correctly set to <code>legacy</code> after replication.
Both TrueTool and Heavyscript have added scripting to fix this issue, however it does not seem to be a priority for iX-Systems to fix upstream.
To fix this issue manually, run:</p><blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">zfs </span><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">mountpoint</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">legacy </span><span class="token string" style="color:#e3116c">&quot;$(zfs list -t filesystem -r &quot;</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable" style="color:#36acaa">cli -c </span><span class="token string variable string" style="color:#e3116c">&#x27;app kubernetes config&#x27;</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable function" style="color:#d73a49">grep</span><span class="token string variable" style="color:#36acaa"> -E </span><span class="token string variable string" style="color:#e3116c">&quot;pool\s\|&quot;</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable function" style="color:#d73a49">awk</span><span class="token string variable" style="color:#36acaa"> -F </span><span class="token string variable string" style="color:#e3116c">&#x27;|&#x27;</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">&#x27;{print $3}&#x27;</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable function" style="color:#d73a49">tr</span><span class="token string variable" style="color:#36acaa"> -d </span><span class="token string variable string" style="color:#e3116c">&quot; </span><span class="token string variable string entity" style="color:#36acaa">\t</span><span class="token string variable string entity" style="color:#36acaa">\n</span><span class="token string variable string entity" style="color:#36acaa">\r</span><span class="token string variable string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> -o name -H </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;volumes/pvc&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">&quot; </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></blockquote><p>Jira Ticket:
<a href="https://ixsystems.atlassian.net/browse/NAS-118570" target="_blank" rel="noopener noreferrer">https://ixsystems.atlassian.net/browse/NAS-118570</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/truecharts/website/tree/master/docs/manual/guides/backup-restore.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/manual/guides/docker-compose"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Docker-Compose on SCALE</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/manual/guides/pvc-access"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Accessing PVC Data</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#requirements" class="table-of-contents__link toc-highlight">Requirements</a><ul><li><a href="#zfs-replication" class="table-of-contents__link toc-highlight">ZFS replication</a></li></ul></li><li><a href="#backup" class="table-of-contents__link toc-highlight">Backup</a><ul><li><a href="#exporting-backups" class="table-of-contents__link toc-highlight">Exporting Backups</a></li><li><a href="#checking-backups" class="table-of-contents__link toc-highlight">Checking Backups</a></li></ul></li><li><a href="#restore" class="table-of-contents__link toc-highlight">Restore</a><ul><li><a href="#reverting-a-running-system" class="table-of-contents__link toc-highlight">Reverting a running system</a></li><li><a href="#total-system-restore-and-migration-to-new-system" class="table-of-contents__link toc-highlight">Total System restore and Migration to new system</a></li></ul></li><li><a href="#video-guide" class="table-of-contents__link toc-highlight">Video Guide</a></li><li><a href="#developer-notes" class="table-of-contents__link toc-highlight">Developer notes</a><ul><li><a href="#pvc-mountpoints-on-replication" class="table-of-contents__link toc-highlight">PVC mountpoints on replication</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Other</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/manual/FAQ">FAQ</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/useTrueCharts" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/tVsPTHWTtr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/truecharts" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/s/truecharts" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/codeofconduct" target="_blank" rel="noopener noreferrer" class="footer__link-item">Code of Conduct<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/LICENSE" target="_blank" rel="noopener noreferrer" class="footer__link-item">License<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/Apach2-license" target="_blank" rel="noopener noreferrer" class="footer__link-item">Apach2-license<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 TrueCharts</div></div></div></footer></div>
<script src="/assets/js/runtime~main.2f9b4fac.js"></script>
<script src="/assets/js/main.4280ca0c.js"></script>
</body>
</html>