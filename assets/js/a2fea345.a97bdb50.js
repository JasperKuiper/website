"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[10642],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return m}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),p=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(o.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=p(n),m=r,f=c["".concat(o,".").concat(m)]||c[m]||u[m]||i;return n?a.createElement(f,s(s({ref:t},d),{},{components:n})):a.createElement(f,s({ref:t},d))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,s=new Array(i);s[0]=c;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l.mdxType="string"==typeof e?e:r,s[1]=l;for(var p=2;p<i;p++)s[p]=n[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},79763:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return o},default:function(){return m},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return u}});var a=n(83117),r=n(80102),i=(n(67294),n(3905)),s=["components"],l={},o="MetalLB Basic Setup",p={unversionedId:"charts/enterprise/metallb/setup-guide",id:"charts/enterprise/metallb/setup-guide",title:"MetalLB Basic Setup",description:"The guide walks through a basic configuration of MetalLB for a single address pool on a layer 2 network. This will allow assigning different IP addresses by app.",source:"@site/docs/charts/enterprise/metallb/setup-guide.md",sourceDirName:"charts/enterprise/metallb",slug:"/charts/enterprise/metallb/setup-guide",permalink:"/docs/charts/enterprise/metallb/setup-guide",draft:!1,editUrl:"https://github.com/truecharts/website/tree/master/docs/charts/enterprise/metallb/setup-guide.md",tags:[],version:"current",frontMatter:{},sidebar:"chartsSidebar",previous:{title:"Changelog",permalink:"/docs/charts/enterprise/metallb/CHANGELOG"},next:{title:"Changelog",permalink:"/docs/charts/enterprise/testwarden/CHANGELOG"}},d={},u=[{value:"1. Install MetalLB without any config changes",id:"1-install-metallb-without-any-config-changes",level:2},{value:"2. Configure Address Pool &amp; L2 Advertisement",id:"2-configure-address-pool--l2-advertisement",level:2},{value:"3. Disable SCALE&#39;s Default Loadbalancer",id:"3-disable-scales-default-loadbalancer",level:2},{value:"4. Optional: Specify IP Address per App or Service",id:"4-optional-specify-ip-address-per-app-or-service",level:2}],c={toc:u};function m(e){var t=e.components,l=(0,r.Z)(e,s);return(0,i.kt)("wrapper",(0,a.Z)({},c,l,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"metallb-basic-setup"},"MetalLB Basic Setup"),(0,i.kt)("p",null,"The guide walks through a basic configuration of MetalLB for a single address pool on a layer 2 network. This will allow assigning different IP addresses by app."),(0,i.kt)("h2",{id:"1-install-metallb-without-any-config-changes"},"1. Install MetalLB without any config changes"),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"The MetalLB chart must be installed initially without any config changes. Once it is installed, proceed to Step 2 and edit the config.")),(0,i.kt)("h2",{id:"2-configure-address-pool--l2-advertisement"},"2. Configure Address Pool & L2 Advertisement"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"metallb-addpoolbasic",src:n(93166).Z,width:"1506",height:"1196"})),(0,i.kt)("p",null,"Create a new entry under ",(0,i.kt)("inlineCode",{parentName:"p"},"Configure IP Address Pools Object")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Name"),": Enter a general name for this IP range. Something like ",(0,i.kt)("em",{parentName:"li"},"apps")," or ",(0,i.kt)("em",{parentName:"li"},"charts")," for this field is fine."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Auto Assign"),": if you want MetalLB Services to auto-assign IPs from the configured address pool without needing to specify per app. Recommendation is to keep this checked. You can still specify an IP for apps as needed (see step 4).")),(0,i.kt)("p",null,"Create a single entry under ",(0,i.kt)("inlineCode",{parentName:"p"},"Configure Address Pools")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Address Pool Entry:")," Specify an IP range for MetalLB to assign IPs that is ",(0,i.kt)("strong",{parentName:"li"},"OUTSIDE")," your current DHCP range on your LAN. For example, if your DHCP range is ",(0,i.kt)("inlineCode",{parentName:"li"},"192.168.1.100-192.168.1.255"),", then your entry can be any range below ",(0,i.kt)("inlineCode",{parentName:"li"},"192.168.1.100"),". This entry can also be specified in CIDR format.")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"For users with VLANs or multiple subnets, you may create create additional address pool objects as needed.")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"metallb-l2advertisement",src:n(54174).Z,width:"1564",height:"1108"})),(0,i.kt)("p",null,"Create a new entry under ",(0,i.kt)("inlineCode",{parentName:"p"},"Configure L2 Advertisements"),"."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Name"),": Enter a basic name for your layer 2 advertisement."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Address Pool Entry:")," This should match the ",(0,i.kt)("strong",{parentName:"li"},"name")," of the address pool created above (not the IP range itself).")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"For users with VLANs or multiple subnets, you may reference multiple address pool objects under a single L2 Advertisement entry as needed.")),(0,i.kt)("h2",{id:"3-disable-scales-default-loadbalancer"},"3. Disable SCALE's Default Loadbalancer"),(0,i.kt)("p",null,"With MetalLB installed and configured, you must now disable SCALE's default loadbalancer."),(0,i.kt)("p",null,"In the SCALE UI, under ",(0,i.kt)("strong",{parentName:"p"},"Apps")," > ",(0,i.kt)("strong",{parentName:"p"},"Settings")," > ",(0,i.kt)("strong",{parentName:"p"},"Advanced Settings")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"metallb-disable",src:n(76336).Z,width:"946",height:"1022"})),(0,i.kt)("p",null,"Uncheck ",(0,i.kt)("inlineCode",{parentName:"p"},"Enable Integrated Loadbalancer"),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"This will trigger a restart of Kubernetes and all apps"),". After roughly 5-10 minutes, your apps will redeploy using the MetalLB-assigned addresses."),(0,i.kt)("h2",{id:"4-optional-specify-ip-address-per-app-or-service"},"4. Optional: Specify IP Address per App or Service"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"metallb-specifyIP",src:n(9662).Z,width:"1506",height:"1246"})),(0,i.kt)("p",null,"With MetalLB installed, you may optionally specify IP addresses for your apps."),(0,i.kt)("p",null,"For each app, under ",(0,i.kt)("strong",{parentName:"p"},"Networking and Services"),", select ",(0,i.kt)("inlineCode",{parentName:"p"},"LoadBalancer")," Service Type for the Main Service."),(0,i.kt)("p",null,"In the ",(0,i.kt)("strong",{parentName:"p"},"LoadBalancer IP")," field, specify an IP address that is within the MetalLB address pool that you configured."),(0,i.kt)("p",null,"With the Main Service assigned, you do not need to specify an IP address for other services under the same app, unless you specifically want a different IP address for that service."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"By default all services under a single app will be assigned the same IP address.")),(0,i.kt)("p",null,"You may need to stop & restart the app for the IP address to take affect."),(0,i.kt)("p",null,"From your SCALE shell, run the command ",(0,i.kt)("inlineCode",{parentName:"p"},"k3s kubectl get svc -A")," to verify the IP addresses assigned for each of your apps. The IPs will be listed under the ",(0,i.kt)("inlineCode",{parentName:"p"},"EXTERNAL-IP")," column."),(0,i.kt)("p",null,"If you have an IP conflict with a previously assigned address it will show as ",(0,i.kt)("inlineCode",{parentName:"p"},"<pending>"),". You may need to do a system reboot as well to properly resolve the conflict."),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"Known Issue: On the SCALE Installed Applications page, the ",(0,i.kt)("strong",{parentName:"p"},"Open")," buttons on each app card will still open a URL to your app using your SCALE Host IP, rather than the MetalLB-Assigned IP. This may be resolved in the future.")),(0,i.kt)("p",null,"For details on other configuration options, please reference the ",(0,i.kt)("a",{parentName:"p",href:"https://metallb.universe.tf/configuration/"},"MetaLB documentation")))}m.isMDXComponent=!0},93166:function(e,t,n){t.Z=n.p+"assets/images/metallb_guide_addresspool_basic-3a4c701591f41a719f49dc2879a662ca.png"},76336:function(e,t,n){t.Z=n.p+"assets/images/metallb_guide_disableLB-bb0cf887232414d5d9c788a66e6f7213.png"},54174:function(e,t,n){t.Z=n.p+"assets/images/metallb_guide_l2advertisement-f957198af0975b52e0fa12f98b3c219c.png"},9662:function(e,t,n){t.Z=n.p+"assets/images/metallb_guide_specifyIP-e175af5b1721ce56b885489095923668.png"}}]);